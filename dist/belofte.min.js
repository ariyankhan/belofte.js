!function(e,n){"use strict";"function"==typeof define&&define.amd?define(function(){return n(e)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=n(e):e.Belofte=n(e)}("undefined"!=typeof window?window:global,function(e){"use strict";Object.defineProperty;var n=Object.defineProperties,t=Array.prototype.slice,r=(Array.prototype.forEach,Array.isArray),i=Math.floor,o=Math.abs,u=Math.max,c=(Math.min,function(){}),f=function(e){return"function"==typeof e},s=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)},l=function(e){return void 0===e||null===e},a=f(e.setImmediate)?function(n){e.setImmediate(n)}:"object"==typeof e.process&&f(e.process.nextTick)?function(n){e.process.nextTick(n)}:function(n){e.setTimeout(n,0)},d=function(e,n){if(!f(e))throw new TypeError(e+" is not a function");var r=t.call(arguments,2);a(function(){e.apply(n,r)})},h=function(e){return O.resolve(e)},v=function(e){return O.reject(e)},_=function(e){g(this)||(n(this,{_state:{value:"fulfilled"},_value:{value:e}}),this._onFulfilled.length>0&&d(function(e){this._onFulfilled.forEach(function(n){n(e)}),this._onFulfilled.length=0,this._onRejected.length=0},this,e))},p=function(e){g(this)||(n(this,{_state:{value:"rejected"},_reason:{value:e}}),this._onRejected.length>0&&d(function(e){this._onRejected.forEach(function(n){n(e)}),this._onFulfilled.length=0,this._onRejected.length=0},this,e))},j=function(e){n(e,{_isPromise:{value:!0},_onFulfilled:{value:[]},_onRejected:{value:[]},_resolve:{value:_.bind(e),configurable:!0},_reject:{value:p.bind(e),configurable:!0},_state:{value:"pending",configurable:!0},_value:{value:void 0,configurable:!0},_reason:{value:void 0,configurable:!0}})},y=function(e){return"pending"===e._state},w=function(e){return"fulfilled"===e._state},b=function(e){return"rejected"===e._state},g=function(e){return"fulfilled"===e._state||"rejected"===e._state},m=function(e){return-1!==["pending","fulfilled","rejected"].indexOf(String(e))},T=function(e){return!0===e._isPromise&&r(e._onFulfilled)&&r(e._onRejected)&&f(e._resolve)&&f(e._reject)&&m(e._state)&&e.hasOwnProperty("_value")&&e.hasOwnProperty("_reason")},P=function(e){return e instanceof O&&T(e)},E=function(e,t,r){var i,o,u,c,l,a,h=!1;if(e===t)e._reject(new TypeError("Chaining cycle detected for promise"));else if(P(t))w(t)?e._resolve(t._value):b(t)?e._reject(t._reason):y(t)&&(i=t._resolve,l=t._reject,n(t,{_resolve:{value:function(n){i.call(this,n),e._resolve(n)}.bind(t)},_reject:{value:function(n){l.call(this,n),e._reject(n)}.bind(t)}}));else if(s(t))try{o=t.then,f(o)?(u=function(n){h||(t!==n?(h=!0,E(e,n)):e._reject(new TypeError("Chaining cycle detected for thenables")))},c=function(n){h||(h=!0,e._reject(n))},a=function(){try{o.call(t,u,c)}catch(n){h||(h=!0,e._reject(n))}},r?d(a):a()):e._resolve(t)}catch(n){e._reject(n)}else e._resolve(t)},x={};x.extend=function(e){if(l(e))throw new TypeError("Target object can't be null or undefined");e=Object(e);var t,r,i;for(t=1;t<arguments.length;++t)r=arguments[t],l(r)||(r=Object(r),i=Object.getOwnPropertyNames(r).reduce(function(e,n){return e[n]=Object.getOwnPropertyDescriptor(r,n),e},{}),n(e,i));return e};var O=function e(n){if(!(this instanceof e)||P(this))throw new TypeError(String(this)+" is not a promise");if(!f(n))throw new TypeError("Promise resolver "+String(n)+" is not a function");j(this),E(this,{then:n})};x.extend(O,{resolve:function(e){if(P(e))return e;var n=new O(c);return E(n,e,!0),n},reject:function(e){return new O(function(n,t){t(e)})},race:function(e){if(void 0===e||null===e)return new O(function(e,n){d(n,void 0,TypeError("First argument of Promise.race can not be undefined or null"))});var t,r=!1;return t=Number(e.length),t=t!==t?0:t,t=(t<0?-1:1)*i(o(t)),t=u(t,0),new O(function(i,o){var u,c=0;for(u=function(e){var t,u;P(e)?w(e)?r||(r=!0,d(function(){i(e._value)})):b(e)?r||(r=!0,d(function(){o(e._reason)})):y(e)&&(t=e._resolve,u=e._reject,n(e,{_resolve:{value:function(e){t(e),r||(r=!0,i(e))}.bind(e)},_reject:{value:function(e){u(e),r||(r=!0,o(e))}.bind(e)}})):isThenable(e)?d(function(){try{e.then(function(e){r||(r=!0,i(e))},function(e){r||(r=!0,o(e))})}catch(e){o(e)}}):r||(r=!0,d(function(){i(e)}))};c<t;++c)u(e[c])})},all:function(e){if(void 0===e||null===e)return new O(function(e,n){d(n,void 0,TypeError("First argument of Promise.all can not be undefined or null"))});var t,r,c=0;return t=Number(e.length),t=t!==t?0:t,t=(t<0?-1:1)*i(o(t)),t=u(t,0),r=new Array(t),new O(function(i,o){var u,f=0;if(0===t)i(r);else for(u=function(e,u){var f,s;P(e)?w(e)?(r[u]=e._value,++c===t&&d(function(){i(r)})):b(e)?d(function(){o(e._reason)}):y(e)&&(f=e._resolve,s=e._reject,n(e,{_resolve:{value:function(e){f(e),r[u]=e,++c===t&&i(r)}.bind(e)},_reject:{value:function(e){s(e),o(e)}.bind(e)}})):isThenable(e)?d(function(){try{e.then(function(e){r[u]=e,++c===t&&i(r)},function(e){o(e)})}catch(e){o(e)}}):(r[u]=e,++c===t&&d(function(){i(r)}))};f<t;++f)u(e[f],f)})},defer:function(){return new F}}),x.extend(O.prototype,{then:function(e,n){if(!P(this))throw new TypeError(this+" is not a promise");e=f(e)?e:h,n=f(n)?n:v;var t,r,i=new O(c);return t=function(n){var t;try{t=e(n),E(i,t)}catch(e){i._reject(e)}},r=function(e){var t;try{t=n(e),E(i,t)}catch(e){i._reject(e)}},y(this)?(this._onFulfilled.push(t),this._onRejected.push(r)):w(this)?d(t,void 0,this._value):b(this)&&d(r,void 0,this._reason),i},catch:function(e){if(!f(this.then))throw new TypeError("(var).then is not a function");return this.then(void 0,e)},toString:function(){if(!P(this))throw new TypeError(this+" is not a promise");switch(this._state){case"pending":return"Promise { <pending> }";case"fulfilled":return"Promise { "+this._value+" }";case"rejected":return"Promise { <rejected> "+this._reason+" }"}}});var F=function(){this.promise=new O(c)};return x.extend(F.prototype,{resolve:function(e){E(this.promise,e,!0)},reject:function(e){this.promise._reject(e)}}),x.extend(x,{Promise:O,isPromise:P,isPending:y,isFulfilled:w,isRejected:b,isSettled:g,getState:function(e){return P(e)?e._state:null},resolve:function(){return O.resolve(value)},reject:function(){return O.reject(reason)},Deferred:F,defer:function(){return new F},resolved:function(e){return O.resolve(e)},rejected:function(e){return O.reject(e)},deferred:function(){return new F},nextTick:function(e){a(e)}}),x});